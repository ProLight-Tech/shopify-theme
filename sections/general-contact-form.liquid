{{ 'section-general-contact-form.css' | asset_url | stylesheet_tag }}

<div class="quote__page__container">
  <form class="quote__form" id="contact-quote-form">
    <input type="text" name="name" placeholder="Your name" required>
    <input type="email" name="email" placeholder="Your email" required>

    <label for="reason">Reason for Contact:</label>
    <select name="reason" id="reason" required>
      <option value="general">General Support</option>
      <option value="quote">Quote Request</option>
    </select>

    <div id="general-fields">
      <textarea name="message" placeholder="Your message"></textarea>
    </div>

    <div id="quote-fields" style="display:none;">
      <label>Enter SKUs to Request:</label>
      <div id="sku-list">
        <div class="sku-entry">
          <input type="text" name="sku" placeholder="SKU" required>
          <input type="number" name="qty" placeholder="Qty (optional)" min="1">
          <button type="button" class="remove-sku" style="display:none;">✕</button>
        </div>
      </div>
      <button type="button" id="add-sku">+ Add Another SKU</button>
    </div>

    <button type="submit">Send</button>
  </form>

  <div id="form-response"></div>
</div>

<script>
  const reasonSelect = document.getElementById('reason');
  const quoteFields = document.getElementById('quote-fields');
  const generalFields = document.getElementById('general-fields');
  const skuList = document.getElementById('sku-list');
  const addSkuBtn = document.getElementById('add-sku');

  reasonSelect.addEventListener('change', () => {
    const isQuote = reasonSelect.value === 'quote';
    quoteFields.style.display = isQuote ? 'block' : 'none';
    generalFields.style.display = isQuote ? 'none' : 'block';
  });

  addSkuBtn.addEventListener('click', () => {
    const entry = document.createElement('div');
    entry.className = 'sku-entry';
    entry.innerHTML = `
      <input type="text" name="sku" placeholder="SKU" required />
      <input type="number" name="qty" placeholder="Qty (optional)" min="1" />
      <button type="button" class="remove-sku">✕</button>
    `;
    skuList.appendChild(entry);
    updateRemoveButtons();
  });

  function updateRemoveButtons() {
    const buttons = skuList.querySelectorAll('.remove-sku');
    buttons.forEach((btn) => {
      btn.style.display = 'inline';
      btn.onclick = () => btn.parentElement.remove();
    });
  }

  document.getElementById('contact-quote-form').addEventListener('submit', async function (e) {
    e.preventDefault();
    const form = e.target;
    const reason = form.reason.value;

    // Collect SKU list
    let skus = [];
    if (reason === 'quote') {
      skuList.querySelectorAll('.sku-entry').forEach((entry) => {
        const sku = entry.querySelector("input[name='sku']").value.trim();
        const qty = entry.querySelector("input[name='qty']").value.trim();
        if (sku) skus.push({ sku, qty });
      });
    }

    const payload = {
      name: form.name.value,
      email: form.email.value,
      reason,
      message: form.message?.value || '',
      skus,
    };

    console.log(payload);

    // const res = await fetch('https://your-api-id.lambda-url.amazonaws.com/', {
    //   method: 'POST',
    //   headers: { 'Content-Type': 'application/json' },
    //   body: JSON.stringify(payload),
    // });

    // const data = await res.json();
    document.getElementById('form-response').innerText = data.success
      ? 'Submitted successfully!'
      : 'Oops! Something went wrong.';
  });
</script>

{% schema %}
{
  "name": "General submission",
  "settings": [],
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
